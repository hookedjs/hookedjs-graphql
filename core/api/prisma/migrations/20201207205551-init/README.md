# Migration `20201207205551-init`

This migration has been generated by Brian at 12/7/2020, 2:55:51 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."UserRole" AS ENUM ('ADMIN', 'EDITOR', 'AUTHOR')

CREATE TYPE "public"."PostStatus" AS ENUM ('DRAFT', 'PUBLISHED')

CREATE TABLE "ApiAccess" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "ip" TEXT NOT NULL,
    "reqUserId" TEXT,
    "operationName" TEXT NOT NULL,
    "duration" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "ApiError" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "ip" TEXT NOT NULL,
    "reqUserId" TEXT,
    "roles" "UserRole"[],
    "operationName" TEXT NOT NULL,
    "message" TEXT NOT NULL,
    "stack" JSONB NOT NULL,
    "reqBody" JSONB NOT NULL,
    "resBody" JSONB NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "ClientEvent" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "ip" TEXT NOT NULL,
    "reqUserId" TEXT,
    "userAgent" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "context" JSONB,

    PRIMARY KEY ("id")
)

CREATE TABLE "User" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdById" TEXT,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "updatedById" TEXT,
    "name" TEXT NOT NULL,
    "roles" "UserRole"[],
    "email" TEXT NOT NULL,
    "password" TEXT,

    PRIMARY KEY ("id")
)

CREATE TABLE "Post" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdById" TEXT,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "updatedById" TEXT,
    "title" TEXT NOT NULL,
    "status" "PostStatus" NOT NULL,
    "authorId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Tag" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "value" TEXT NOT NULL,
    "postId" TEXT,

    PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE INDEX "User.email_index" ON "User"("email")

ALTER TABLE "ApiAccess" ADD FOREIGN KEY("reqUserId")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "ApiError" ADD FOREIGN KEY("reqUserId")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "ClientEvent" ADD FOREIGN KEY("reqUserId")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "User" ADD FOREIGN KEY("createdById")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "User" ADD FOREIGN KEY("updatedById")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Post" ADD FOREIGN KEY("createdById")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Post" ADD FOREIGN KEY("updatedById")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Post" ADD FOREIGN KEY("authorId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Tag" ADD FOREIGN KEY("postId")REFERENCES "Post"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201207205551-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,118 @@
+// This file was generated by schemaGen.ts
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+generator prisma_client {
+  provider = "prisma-client-js"
+}
+model ApiAccess {
+  id            String   @default(cuid()) @id
+  createdAt     DateTime @default(now())
+
+  /// Ip address of the express req
+  ip            String
+  /// The user id of the express req, if known
+  reqUserId     String?
+  /// The user of the express req, if known
+  reqUser       User?    @relation(fields: [reqUserId], references: [id])
+  /// The GraphQL Operation that was called, if known
+  operationName String
+  /// The amount of time passed to fulfill the request
+  duration      Int
+}
+model ApiError {
+  id            String   @default(cuid()) @id
+  createdAt     DateTime @default(now())
+
+  /// Ip address of the express req
+  ip            String
+  /// The user id of the express req, if known
+  reqUserId     String?
+  /// The user of the express req, if known
+  reqUser       User?    @relation(fields: [reqUserId], references: [id])
+  /// The user roles of the express req, if known
+  roles         UserRole[]
+  /// The GraphQL Operation that was called, if known
+  operationName String
+  /// The error message
+  message       String
+  /// A callstack if available
+  stack         Json
+  /// The body of the express request
+  reqBody       Json
+  /// The body of the express response
+  resBody       Json
+}
+model ClientEvent {
+  id            String   @default(cuid()) @id
+  createdAt     DateTime @default(now())
+
+  /// Ip address of the express req
+  ip            String
+  /// The user id of the express req, if known
+  reqUserId     String?
+  /// The user of the express req, if known
+  reqUser       User?    @relation(fields: [reqUserId], references: [id])
+  /// The user agent of the request -- useful to know what type of device
+  userAgent     String
+  /// The name of the event
+  name          String
+  /// Event args/context
+  context       Json?
+}
+model User {
+  id            String      @default(cuid()) @id
+  createdAt     DateTime    @default(now())
+  createdById   String?
+  createdBy     User?       @relation("UsersCreatedByUser", fields: [createdById], references: [id])
+  usersCreated User[]       @relation("UsersCreatedByUser")
+
+  updatedAt     DateTime    @updatedAt
+  updatedById   String?
+  updatedBy     User?       @relation("UsersUpdatedByUser", fields: [updatedById], references: [id])
+  usersUpdated User[]       @relation("UsersUpdatedByUser")
+
+  name          String
+  roles         UserRole[]
+  email         String      @unique
+  password      String?
+
+  @@index([email])
+
+  postsAuthoredJ Post[]      @relation("PostsAuthoredByUser")
+  postsCreatedJ  Post[]      @relation("PostsCreatedByUser")
+  postsUpdatedJ  Post[]      @relation("PostsUpdatedByUser")
+}
+enum UserRole {
+  ADMIN
+  EDITOR
+  AUTHOR
+}
+model Post {
+  id            String     @default(cuid()) @id
+  createdAt     DateTime   @default(now())
+  createdById   String?
+  createdBy     User?      @relation("PostsCreatedByUser", fields: [createdById], references: [id])
+  updatedAt     DateTime   @updatedAt
+  updatedById   String?
+  updatedBy     User?      @relation("PostsUpdatedByUser", fields: [updatedById], references: [id])
+
+  title         String
+  tags          Tag[]
+  status        PostStatus
+  authorId      String
+  author        User       @relation("PostsAuthoredByUser", fields: [authorId], references: [id])
+}
+enum PostStatus {
+  DRAFT
+  PUBLISHED
+}
+model Tag {
+  id     Int         @default(autoincrement()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  value  String
+  postId String?
+  post   Post?       @relation(fields: [postId], references: [id])
+}
```


